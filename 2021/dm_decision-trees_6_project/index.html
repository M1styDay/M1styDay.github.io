<!DOCTYPE html>
<html lang="en-us">
  <link href="//use.fontawesome.com/releases/v5.9.0/css/all.css" rel="stylesheet">
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <script async src="https://cdn.splitbee.io/sb.js"></script>
  <script src="https://cdn.splitbee.io/sb-ab.js"></script>
  <meta name="author" content="M1sty">
  
  
  
  <link rel="prev" href="https://www.m1sty.com/2021/ed_6_deep-learning-and-neural-networks/" />
  <link rel="next" href="https://www.m1sty.com/2021/dm_decision-trees_5_practise/" />
  <link rel="canonical" href="https://www.m1sty.com/2021/dm_decision-trees_6_project/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           Decision Trees：Project | M1sty
       
  </title>
  <meta name="title" content="Decision Trees：Project | M1sty">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/www.m1sty.com"
    },
    "articleSection" : "posts",
    "name" : "Decision Trees：Project",
    "headline" : "Decision Trees：Project",
    "description" : "随机森林模型项目代码 建模版 导入数据 import pandas as pd import numpy as np import matplotlib.pyplot as plt import seaborn as sns import numpy as nps from scipy import stats from sklearn import metrics # 导入Excel文档 data=pd.read_excel(\u0026#39;D:\\\\Britney\\\\项目1\\\\K数据.xlsx\u0026#39;) 数据预处理 # 去除为0的行 a=data[data[\u0026#39;大货唛架 YY\u0026#39;]==0].index data1=data.drop(a,axis=0) data1[data1[\u0026#39;大货唛架 YY\u0026#39;].isin([0])] y1=data1[\u0026#39;大货唛架利用率%\u0026#39;] y2=data1[\u0026#39;大货唛架 YY\u0026#39;] #如果缺失率达到40%就可以去除该因子 d1=data1.isnull().sum()\/data1.shape[0] #a=d1\u0026gt;0.5 a1=pd.DataFrame(d1) print(a1[a1[0]\u0026gt;0.4]) #去掉缺失率过大的因子 data2=data1.drop([\u0026#39;后整方式\u0026#39;,\u0026#39;循环尺寸标准_经向(Inch)\u0026#39;,\u0026#39;循环尺寸标准_纬向(Inch)\u0026#39;],axis=1) # 类型变量集合 quality=[attr for attr in data2.columns if data2.dtypes[attr] == \u0026#39;object\u0026#39;] # 类型变量缺失值补全 for c in quality: data2[c] = data2[c].",
    "inLanguage" : "en-us",
    "author" : "Misty",
    "creator" : "Misty",
    "publisher": "Misty",
    "accountablePerson" : "Misty",
    "copyrightHolder" : "Misty",
    "copyrightYear" : "2021",
    "datePublished": "2021-04-05 00:00:00 \u002b0000 UTC",
    "dateModified" : "2021-04-05 00:00:00 \u002b0000 UTC",
    "url" : "https:\/\/www.m1sty.com\/2021\/dm_decision-trees_6_project\/",
    "wordCount" : "462",
    "keywords" : [ "Decistion Trees","Practise", "M1sty"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://www.m1sty.com">M1sty</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="About">About</a>
                
                <a class="menu-item" href="/links/" title="Links">Links</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://www.m1sty.com">M1sty</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="About">About</a>
                
                <a class="menu-item" href="/links/" title="Links">Links</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Decision Trees：Project</h1>
        <div class="post-meta">
        <i class="far fa-folder-open"></i>
            <span class="post-category"> in
                <a href="https://www.m1sty.com/categories/data-mining/"> Data Mining </a>
                    
            </span>
          <span class="post-time"> on
        <time datetime=2021-04-05 itemprop="datePublished">April 5, 2021</time>
           </span> (<span class="post-word-count">462 words)</span>
        </div>
    
    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title"></h2>
  
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#建模版">建模版</a>
      <ul>
        <li><a href="#导入数据">导入数据</a></li>
        <li><a href="#数据预处理">数据预处理</a></li>
        <li><a href="#构建随机森林模型">构建随机森林模型</a></li>
        <li><a href="#画图拟合优度均方误差">画图/拟合优度/均方误差</a></li>
        <li><a href="#输出结果">输出结果</a></li>
      </ul>
    </li>
    <li><a href="#预测版">预测版</a></li>
  </ul>
</nav>
  </div>
</div>
<script type="text/javascript">
  window.onload = function () {
    var fix = $('.post-toc');
    var end = $('.post-comment');
    var fixTop = fix.offset().top, fixHeight = fix.height();
    var endTop, miss;
    var offsetTop = fix[0].offsetTop;
    $(window).scroll(function () {
      var docTop = Math.max(document.body.scrollTop, document.documentElement.scrollTop);
      if (end.length > 0) {
        endTop = end.offset().top;
        miss = endTop - docTop - fixHeight;
      }
      if (fixTop < docTop) {
        fix.css({ 'position': 'fixed' });
        if ((end.length > 0) && (endTop < (docTop + fixHeight))) {
          fix.css({ top: miss });
        } else {
          fix.css({ top: 0 });
        }
      } else {
        fix.css({ 'position': 'absolute' });
        fix.css({ top: offsetTop });
      }
    })
  }
</script> 
    
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          <h1 id="随机森林模型项目代码">随机森林模型项目代码</h1>
<h2 id="建模版">建模版</h2>
<h3 id="导入数据">导入数据</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">import</span> seaborn <span style="color:#f92672">as</span> sns
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> nps  
<span style="color:#f92672">from</span> scipy <span style="color:#f92672">import</span> stats
<span style="color:#f92672">from</span> sklearn <span style="color:#f92672">import</span> metrics

<span style="color:#75715e"># 导入Excel文档</span>
data<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>read_excel(<span style="color:#e6db74">&#39;D:</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">Britney</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">项目1</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">K数据.xlsx&#39;</span>)
</code></pre></div><h3 id="数据预处理">数据预处理</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># 去除为0的行</span>
a<span style="color:#f92672">=</span>data[data[<span style="color:#e6db74">&#39;大货唛架 YY&#39;</span>]<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>index
data1<span style="color:#f92672">=</span>data<span style="color:#f92672">.</span>drop(a,axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
data1[data1[<span style="color:#e6db74">&#39;大货唛架 YY&#39;</span>]<span style="color:#f92672">.</span>isin([<span style="color:#ae81ff">0</span>])]

y1<span style="color:#f92672">=</span>data1[<span style="color:#e6db74">&#39;大货唛架利用率%&#39;</span>]
y2<span style="color:#f92672">=</span>data1[<span style="color:#e6db74">&#39;大货唛架 YY&#39;</span>]

<span style="color:#75715e">#如果缺失率达到40%就可以去除该因子</span>
d1<span style="color:#f92672">=</span>data1<span style="color:#f92672">.</span>isnull()<span style="color:#f92672">.</span>sum()<span style="color:#f92672">/</span>data1<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]
<span style="color:#75715e">#a=d1&gt;0.5</span>
a1<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>DataFrame(d1)
<span style="color:#66d9ef">print</span>(a1[a1[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">0.4</span>])

<span style="color:#75715e">#去掉缺失率过大的因子</span>
data2<span style="color:#f92672">=</span>data1<span style="color:#f92672">.</span>drop([<span style="color:#e6db74">&#39;后整方式&#39;</span>,<span style="color:#e6db74">&#39;循环尺寸标准_经向(Inch)&#39;</span>,<span style="color:#e6db74">&#39;循环尺寸标准_纬向(Inch)&#39;</span>],axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)

<span style="color:#75715e"># 类型变量集合</span>
quality<span style="color:#f92672">=</span>[attr <span style="color:#66d9ef">for</span> attr <span style="color:#f92672">in</span> data2<span style="color:#f92672">.</span>columns <span style="color:#66d9ef">if</span> data2<span style="color:#f92672">.</span>dtypes[attr] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;object&#39;</span>]  
 
<span style="color:#75715e"># 类型变量缺失值补全</span>
<span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> quality:  
    data2[c] <span style="color:#f92672">=</span> data2[c]<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;category&#39;</span>)
    <span style="color:#66d9ef">if</span> data2[c]<span style="color:#f92672">.</span>isnull()<span style="color:#f92672">.</span>any():                                            
        data2[c] <span style="color:#f92672">=</span> data2[c]<span style="color:#f92672">.</span>cat<span style="color:#f92672">.</span>add_categories([<span style="color:#e6db74">&#39;MISSING&#39;</span>])
        data2[c] <span style="color:#f92672">=</span> data2[c]<span style="color:#f92672">.</span>fillna(<span style="color:#e6db74">&#39;MISSING&#39;</span>)

 
<span style="color:#75715e">#将数值型变量的缺失值用平均值代替</span>
quantity<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;缩水率标准_L%&#39;</span>,<span style="color:#e6db74">&#39;缩水率标准_W%&#39;</span>]
<span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> quantity:               <span style="color:#75715e">#mean() 求平均值</span>
    mean_value <span style="color:#f92672">=</span> data2[x]<span style="color:#f92672">.</span>mean()
    data2[x] <span style="color:#f92672">=</span> data2[x]<span style="color:#f92672">.</span>replace(np<span style="color:#f92672">.</span>NaN, mean_value)

<span style="color:#75715e">#将类型变量编码</span>
<span style="color:#f92672">from</span> category_encoders <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
YY_test <span style="color:#f92672">=</span> data2[<span style="color:#e6db74">&#39;大货唛架利用率%&#39;</span>]
XX_test <span style="color:#f92672">=</span> data2[<span style="color:#e6db74">&#39;大货唛架 YY&#39;</span>]
X<span style="color:#f92672">=</span>data2<span style="color:#f92672">.</span>drop([<span style="color:#e6db74">&#39;大货唛架利用率%&#39;</span>,<span style="color:#e6db74">&#39;大货唛架 YY&#39;</span>],axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
enc <span style="color:#f92672">=</span> OrdinalEncoder(cols<span style="color:#f92672">=</span>([<span style="color:#e6db74">&#39;Factory&#39;</span>, <span style="color:#e6db74">&#39;GMT Color Code&#39;</span>,<span style="color:#e6db74">&#39;Customer Code &#39;</span>, <span style="color:#e6db74">&#39;Gender&#39;</span>, <span style="color:#e6db74">&#39;Prod Category&#39;</span>, <span style="color:#e6db74">&#39;Finishing &amp; Wash&#39;</span>,<span style="color:#e6db74">&#39;Quality Code&#39;</span>, <span style="color:#e6db74">&#39;Season Code&#39;</span>, <span style="color:#e6db74">&#39;Style No&#39;</span>, <span style="color:#e6db74">&#39;款式&#39;</span>, <span style="color:#e6db74">&#39;袖形描述-以长/短为主&#39;</span>, <span style="color:#e6db74">&#39;袋形描述-以单/双为主&#39;</span>, <span style="color:#e6db74">&#39;介英描述&#39;</span>, <span style="color:#e6db74">&#39;领形描述-MI&#39;</span>, <span style="color:#e6db74">&#39;Fab Pattern&#39;</span>, <span style="color:#e6db74">&#39;裁向&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_筒&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_钮子&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_纳膊&#39;</span>,<span style="color:#e6db74">&#39;对条/格要求_口袋&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_前幅&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_后幅&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_侧骨&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_袖&#39;</span>,<span style="color:#e6db74">&#39;对条/格要求_上级领&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_介英&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_袖侧&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_担干&#39;</span>, <span style="color:#e6db74">&#39;成衣花型&#39;</span>, <span style="color:#e6db74">&#39;COMBO&#39;</span>, <span style="color:#e6db74">&#39;布种&#39;</span>, <span style="color:#e6db74">&#39;成分&#39;</span>, <span style="color:#e6db74">&#39;N纱类&#39;</span>, <span style="color:#e6db74">&#39;N布的花型&#39;</span>, <span style="color:#e6db74">&#39;N纱支&#39;</span>,<span style="color:#e6db74">&#39;工艺布封&#39;</span>, <span style="color:#e6db74">&#39;成衣尺码类别&#39;</span>,<span style="color:#e6db74">&#39;纸样尺寸单位&#39;</span>, <span style="color:#e6db74">&#39;尺码类别&#39;</span>, <span style="color:#e6db74">&#39;尺码范围1&#39;</span>, <span style="color:#e6db74">&#39;后中衫长&#39;</span>, <span style="color:#e6db74">&#39;胸围&#39;</span>, <span style="color:#e6db74">&#39;夹圈&#39;</span>, <span style="color:#e6db74">&#39;袖长&#39;</span>, <span style="color:#e6db74">&#39;臂围&#39;</span>, <span style="color:#e6db74">&#39;坐围&#39;</span>, <span style="color:#e6db74">&#39;裤长&#39;</span>,<span style="color:#e6db74">&#39;尺码范围2&#39;</span>, <span style="color:#e6db74">&#39;订单数比率&#39;</span>]))<span style="color:#f92672">.</span>fit(X, y2)
ht<span style="color:#f92672">=</span>enc<span style="color:#f92672">.</span>transform(X)
ht<span style="color:#f92672">.</span>head()

<span style="color:#75715e">#将变量转为数值型变量</span>
ht[<span style="color:#e6db74">&#39;缩水率标准_L%&#39;</span>]<span style="color:#f92672">=</span>ht[<span style="color:#e6db74">&#39;缩水率标准_L%&#39;</span>]<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;int&#39;</span>)
ht[<span style="color:#e6db74">&#39;缩水率标准_W%&#39;</span>]<span style="color:#f92672">=</span>ht[<span style="color:#e6db74">&#39;缩水率标准_W%&#39;</span>]<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;int&#39;</span>)
</code></pre></div><h3 id="构建随机森林模型">构建随机森林模型</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> sklearn.model_selection <span style="color:#f92672">import</span> train_test_split
<span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> r2_score
<span style="color:#f92672">from</span> sklearn.ensemble <span style="color:#f92672">import</span> RandomForestRegressor

<span style="color:#75715e">#设置训练集</span>
X2<span style="color:#f92672">=</span>ht<span style="color:#f92672">.</span>drop([],axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
X_train, X_test, Y_train, Y_test <span style="color:#f92672">=</span> train_test_split(X2, y1, test_size<span style="color:#f92672">=</span><span style="color:#ae81ff">0.3</span>,random_state<span style="color:#f92672">=</span><span style="color:#ae81ff">42</span>)

<span style="color:#75715e">#使用随机森林建模</span>
model <span style="color:#f92672">=</span>RandomForestRegressor()
model<span style="color:#f92672">.</span>fit(X_train,Y_train)
predicted <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(X2)
</code></pre></div><h3 id="画图拟合优度均方误差">画图/拟合优度/均方误差</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#这是画图，画预测值和原值两者 </span>
plt<span style="color:#f92672">.</span>scatter(range(X2<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]), YY_test, marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;x&#39;</span>)
plt<span style="color:#f92672">.</span>plot(range(X2<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]), predicted, c<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;r&#39;</span>)
plt<span style="color:#f92672">.</span>show()

<span style="color:#75715e">#拟合优度检验</span>
<span style="color:#66d9ef">print</span>(r2_score(YY_test,predicted))

<span style="color:#75715e">#均方误差</span>
rmse <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sqrt(metrics<span style="color:#f92672">.</span>mean_squared_error(YY_test, predicted))
<span style="color:#66d9ef">print</span>(rmse)
</code></pre></div><h3 id="输出结果">输出结果</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#输出预测结果</span>
test<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>DataFrame(YY_test)
test<span style="color:#f92672">.</span>to_excel(<span style="color:#e6db74">&#39;D:</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">Britney</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">项目1</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">预测大货唛架利用率te.xlsx&#39;</span>)
predicted3<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>DataFrame(predicted)
predicted3<span style="color:#f92672">.</span>to_excel(<span style="color:#e6db74">&#39;D:</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">Britney</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">项目1</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">预测大货唛架利用率yc.xlsx&#39;</span>)
</code></pre></div><h2 id="预测版">预测版</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">import</span> seaborn <span style="color:#f92672">as</span> sns
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> nps  
<span style="color:#f92672">from</span> scipy <span style="color:#f92672">import</span> stats
<span style="color:#f92672">from</span> sklearn <span style="color:#f92672">import</span> metrics

<span style="color:#75715e"># 导入Excel文档</span>
data<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>read_excel(<span style="color:#e6db74">&#39;D:</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">Britney</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">项目2</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">K数据.xlsx&#39;</span>)
<span style="color:#75715e"># 去除为0的行</span>
a<span style="color:#f92672">=</span>data[data[<span style="color:#e6db74">&#39;大货唛架 YY&#39;</span>]<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>index
data1<span style="color:#f92672">=</span>data<span style="color:#f92672">.</span>drop(a,axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
data1[data1[<span style="color:#e6db74">&#39;大货唛架 YY&#39;</span>]<span style="color:#f92672">.</span>isin([<span style="color:#ae81ff">0</span>])]

y1<span style="color:#f92672">=</span>data1[<span style="color:#e6db74">&#39;大货唛架利用率%&#39;</span>]
y2<span style="color:#f92672">=</span>data1[<span style="color:#e6db74">&#39;大货唛架 YY&#39;</span>]

<span style="color:#75715e">#如果缺失率达到40%就可以去除该因子</span>
d1<span style="color:#f92672">=</span>data1<span style="color:#f92672">.</span>isnull()<span style="color:#f92672">.</span>sum()<span style="color:#f92672">/</span>data1<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]
<span style="color:#75715e">#a=d1&gt;0.5</span>
a1<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>DataFrame(d1)
<span style="color:#66d9ef">print</span>(a1[a1[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">0.4</span>])

<span style="color:#75715e">#去掉缺失率过大的因子</span>
data2<span style="color:#f92672">=</span>data1<span style="color:#f92672">.</span>drop([<span style="color:#e6db74">&#39;后整方式&#39;</span>,<span style="color:#e6db74">&#39;循环尺寸标准_经向(Inch)&#39;</span>,<span style="color:#e6db74">&#39;循环尺寸标准_纬向(Inch)&#39;</span>],axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)

<span style="color:#75715e"># 类型变量集合</span>
quality<span style="color:#f92672">=</span>[attr <span style="color:#66d9ef">for</span> attr <span style="color:#f92672">in</span> data2<span style="color:#f92672">.</span>columns <span style="color:#66d9ef">if</span> data2<span style="color:#f92672">.</span>dtypes[attr] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;object&#39;</span>]  
 
<span style="color:#75715e"># 类型变量缺失值补全</span>
<span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> quality:  
    data2[c] <span style="color:#f92672">=</span> data2[c]<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;category&#39;</span>)
    <span style="color:#66d9ef">if</span> data2[c]<span style="color:#f92672">.</span>isnull()<span style="color:#f92672">.</span>any():                                            
        data2[c] <span style="color:#f92672">=</span> data2[c]<span style="color:#f92672">.</span>cat<span style="color:#f92672">.</span>add_categories([<span style="color:#e6db74">&#39;MISSING&#39;</span>])
        data2[c] <span style="color:#f92672">=</span> data2[c]<span style="color:#f92672">.</span>fillna(<span style="color:#e6db74">&#39;MISSING&#39;</span>)

<span style="color:#75715e">#将数值型变量的缺失值用平均值代替</span>
quantity<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;缩水率标准_L%&#39;</span>,<span style="color:#e6db74">&#39;缩水率标准_W%&#39;</span>]
<span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> quantity:               <span style="color:#75715e">#mean() 求平均值</span>
    mean_value <span style="color:#f92672">=</span> data2[x]<span style="color:#f92672">.</span>mean()
    data2[x] <span style="color:#f92672">=</span> data2[x]<span style="color:#f92672">.</span>replace(np<span style="color:#f92672">.</span>NaN, mean_value)

 
<span style="color:#75715e">#将类型变量编码</span>
<span style="color:#f92672">from</span> category_encoders <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
X<span style="color:#f92672">=</span>data2<span style="color:#f92672">.</span>drop([<span style="color:#e6db74">&#39;大货唛架利用率%&#39;</span>,<span style="color:#e6db74">&#39;大货唛架 YY&#39;</span>],axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
enc <span style="color:#f92672">=</span> OrdinalEncoder(cols<span style="color:#f92672">=</span>([<span style="color:#e6db74">&#39;Factory&#39;</span>, <span style="color:#e6db74">&#39;GMT Color Code&#39;</span>,<span style="color:#e6db74">&#39;Customer Code &#39;</span>, <span style="color:#e6db74">&#39;Gender&#39;</span>, <span style="color:#e6db74">&#39;Prod Category&#39;</span>, <span style="color:#e6db74">&#39;Finishing &amp; Wash&#39;</span>,<span style="color:#e6db74">&#39;Quality Code&#39;</span>, <span style="color:#e6db74">&#39;Season Code&#39;</span>, <span style="color:#e6db74">&#39;Style No&#39;</span>, <span style="color:#e6db74">&#39;款式&#39;</span>, <span style="color:#e6db74">&#39;袖形描述-以长/短为主&#39;</span>, <span style="color:#e6db74">&#39;袋形描述-以单/双为主&#39;</span>, <span style="color:#e6db74">&#39;介英描述&#39;</span>, <span style="color:#e6db74">&#39;领形描述-MI&#39;</span>, <span style="color:#e6db74">&#39;Fab Pattern&#39;</span>, <span style="color:#e6db74">&#39;裁向&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_筒&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_钮子&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_纳膊&#39;</span>,<span style="color:#e6db74">&#39;对条/格要求_口袋&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_前幅&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_后幅&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_侧骨&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_袖&#39;</span>,<span style="color:#e6db74">&#39;对条/格要求_上级领&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_介英&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_袖侧&#39;</span>, <span style="color:#e6db74">&#39;对条/格要求_担干&#39;</span>, <span style="color:#e6db74">&#39;成衣花型&#39;</span>, <span style="color:#e6db74">&#39;COMBO&#39;</span>, <span style="color:#e6db74">&#39;布种&#39;</span>, <span style="color:#e6db74">&#39;成分&#39;</span>, <span style="color:#e6db74">&#39;N纱类&#39;</span>, <span style="color:#e6db74">&#39;N布的花型&#39;</span>, <span style="color:#e6db74">&#39;N纱支&#39;</span>,<span style="color:#e6db74">&#39;工艺布封&#39;</span>, <span style="color:#e6db74">&#39;成衣尺码类别&#39;</span>,<span style="color:#e6db74">&#39;纸样尺寸单位&#39;</span>, <span style="color:#e6db74">&#39;尺码类别&#39;</span>, <span style="color:#e6db74">&#39;尺码范围1&#39;</span>, <span style="color:#e6db74">&#39;后中衫长&#39;</span>, <span style="color:#e6db74">&#39;胸围&#39;</span>, <span style="color:#e6db74">&#39;夹圈&#39;</span>, <span style="color:#e6db74">&#39;袖长&#39;</span>, <span style="color:#e6db74">&#39;臂围&#39;</span>, <span style="color:#e6db74">&#39;坐围&#39;</span>, <span style="color:#e6db74">&#39;裤长&#39;</span>,<span style="color:#e6db74">&#39;尺码范围2&#39;</span>, <span style="color:#e6db74">&#39;订单数比率&#39;</span>]))<span style="color:#f92672">.</span>fit(X, y2)
ht<span style="color:#f92672">=</span>enc<span style="color:#f92672">.</span>transform(X)
ht<span style="color:#f92672">.</span>head()

<span style="color:#75715e">#将变量转为数值型变量</span>
ht[<span style="color:#e6db74">&#39;缩水率标准_L%&#39;</span>]<span style="color:#f92672">=</span>ht[<span style="color:#e6db74">&#39;缩水率标准_L%&#39;</span>]<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;int&#39;</span>)
ht[<span style="color:#e6db74">&#39;缩水率标准_W%&#39;</span>]<span style="color:#f92672">=</span>ht[<span style="color:#e6db74">&#39;缩水率标准_W%&#39;</span>]<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;int&#39;</span>)

 
<span style="color:#75715e">#预测大货唛架MU</span>
<span style="color:#75715e">#设置训练集</span>
<span style="color:#f92672">from</span> sklearn.model_selection <span style="color:#f92672">import</span> train_test_split
X2<span style="color:#f92672">=</span>ht<span style="color:#f92672">.</span>drop([<span style="color:#e6db74">&#39;布种&#39;</span>, <span style="color:#e6db74">&#39;成分&#39;</span>, <span style="color:#e6db74">&#39;N纱类&#39;</span>, <span style="color:#e6db74">&#39;N布的花型&#39;</span>, <span style="color:#e6db74">&#39;N纱支&#39;</span>,<span style="color:#e6db74">&#39;缩水率标准_L%&#39;</span>,<span style="color:#e6db74">&#39;缩水率标准_W%&#39;</span>],axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)

<span style="color:#75715e">#导入需要预测的数据</span>
test_data<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>read_excel(<span style="color:#e6db74">&#39;D:</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">Britney</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">项目2</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">K数据new.xlsx&#39;</span>)
test_data<span style="color:#f92672">=</span>test_data<span style="color:#f92672">.</span>drop([<span style="color:#e6db74">&#39;后整方式&#39;</span>,<span style="color:#e6db74">&#39;循环尺寸标准_经向(Inch)&#39;</span>,<span style="color:#e6db74">&#39;循环尺寸标准_纬向(Inch)&#39;</span>],axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
test_data<span style="color:#f92672">=</span>test_data<span style="color:#f92672">.</span>drop([<span style="color:#e6db74">&#39;大货唛架利用率%&#39;</span>,<span style="color:#e6db74">&#39;大货唛架 YY&#39;</span>],axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
test_data<span style="color:#f92672">=</span>enc<span style="color:#f92672">.</span>transform(test_data)
test_data<span style="color:#f92672">.</span>head()  
test_data<span style="color:#f92672">=</span>test_data<span style="color:#f92672">.</span>drop([<span style="color:#e6db74">&#39;布种&#39;</span>, <span style="color:#e6db74">&#39;成分&#39;</span>, <span style="color:#e6db74">&#39;N纱类&#39;</span>, <span style="color:#e6db74">&#39;N布的花型&#39;</span>, <span style="color:#e6db74">&#39;N纱支&#39;</span>,<span style="color:#e6db74">&#39;缩水率标准_L%&#39;</span>,<span style="color:#e6db74">&#39;缩水率标准_W%&#39;</span>],axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)

<span style="color:#75715e">#训练，y1和y2看需要修改</span>
X_train, X_test, Y_train, Y_test <span style="color:#f92672">=</span> train_test_split(X2, y1, test_size<span style="color:#f92672">=</span><span style="color:#ae81ff">0.3</span>,random_state<span style="color:#f92672">=</span><span style="color:#ae81ff">42</span>)
<span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> r2_score
<span style="color:#f92672">from</span> sklearn.ensemble <span style="color:#f92672">import</span> RandomForestRegressor

<span style="color:#75715e">#使用随机森林建模</span>
model <span style="color:#f92672">=</span>RandomForestRegressor()
model<span style="color:#f92672">.</span>fit(X_train,Y_train)

predicted <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(X_test)
answer1 <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(test_data)

<span style="color:#75715e">#这是画图，画预测值和原值两者 </span>
<span style="color:#75715e">#plt.scatter(range(X_test.shape[0]), Y_test, marker=&#39;x&#39;)</span>
plt<span style="color:#f92672">.</span>scatter(range(X_test<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]), Y_test, marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;x&#39;</span>)
<span style="color:#75715e">#plt.plot(range(X_test.shape[0]), predicted, c=&#39;r&#39;)</span>
plt<span style="color:#f92672">.</span>plot(range(X_test<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]), predicted, c<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;r&#39;</span>)
plt<span style="color:#f92672">.</span>show()

<span style="color:#75715e">#拟合优度检验</span>
<span style="color:#66d9ef">print</span>(r2_score(Y_test,predicted))

<span style="color:#75715e">#均方误差</span>
rmse <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sqrt(metrics<span style="color:#f92672">.</span>mean_squared_error(Y_test, predicted))
<span style="color:#66d9ef">print</span>(rmse)

<span style="color:#75715e">#输出预测结果</span>
test<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>DataFrame(Y_test)
test<span style="color:#f92672">.</span>to_excel(<span style="color:#e6db74">&#39;D:</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">Britney</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">项目2</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">针织大货唛架MUte.xlsx&#39;</span>)
predicted1<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>DataFrame(predicted)
predicted1<span style="color:#f92672">.</span>to_excel(<span style="color:#e6db74">&#39;D:</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">Britney</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">项目2</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">针织大货唛架MUyc.xlsx&#39;</span>)
output1<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>DataFrame(answer1)
output1<span style="color:#f92672">.</span>to_excel(<span style="color:#e6db74">&#39;D:</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">Britney</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">项目2</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">针织大货唛架MUan.xlsx&#39;</span>)
</code></pre></div>
    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>M1sty </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://www.m1sty.com/2021/dm_decision-trees_6_project/>https://www.m1sty.com/2021/dm_decision-trees_6_project/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="https://www.m1sty.com/tags/decistion-trees/">
                    #Decistion Trees</a></span>
            
            <span class="tag"><a href="https://www.m1sty.com/tags/practise/">
                    #Practise</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://www.m1sty.com">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://www.m1sty.com/2021/ed_6_deep-learning-and-neural-networks/" class="prev" rel="prev" title="Deep Learning and Neural Networks"><i class="iconfont icon-left"></i>&nbsp;Deep Learning and Neural Networks</a>
         
        
        <a href="https://www.m1sty.com/2021/dm_decision-trees_5_practise/" class="next" rel="next" title="Decision Trees：Practise">Decision Trees：Practise&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2020 - 2021</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://www.m1sty.com">M1sty</a> | </span> 
         

         
		  <span> <a href="https://www.m1sty.com" target="_blank" rel="external nofollow">Data Analyst</a> => <a href="https://www.m1sty.com" target="_blank" rel="external nofollow">Data Scientist</a></span> 
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  




<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            displayMath: [['$$','$$'], ['\[','\]']],
            processEscapes: true,
            processEnvironments: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            TeX: {
                equationNumbers: { autoNumber: "AMS" },
                extensions: ["AMSmath.js", "AMSsymbols.js"]
            }
        }
    });
</script>
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
     </div>
  </body>
</html>
