<!DOCTYPE html>
<html lang="en-us">
  <link href="//use.fontawesome.com/releases/v5.9.0/css/all.css" rel="stylesheet">
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="M1sty">
  
  
  
  <link rel="prev" href="https://www.m1sty.com/2020/database_sql_50/" />
  <link rel="next" href="https://www.m1sty.com/2021/project_data-index_content/" />
  <link rel="canonical" href="https://www.m1sty.com/2021/dm_0_clear/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           数据清洗 | M1sty
       
  </title>
  <meta name="title" content="数据清洗 | M1sty">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/www.m1sty.com"
    },
    "articleSection" : "posts",
    "name" : "数据清洗",
    "headline" : "数据清洗",
    "description" : "常用工具 numpy 构建数组   Numpy中常用的数据结构是ndarray格式\n  使用array函数创建，语法格式为array(列表或元组)\n  可以使用其他函数例如arange、linspace、zeros等创建\n  import numpy as np arr1 = np.array([-9,7,4,3]) np.arange(0,10,1) np.linspace(1,10,10) np.zeros (1,5) 常用方法   常用方法名称：ndim、shape、size、dtype、运算\n  数组访问方法：array$[行，列]$\n  排序  sort函数：从小到大进行排序 argsort函数：返回的是数据中, 从小到大的索引值  s = np.array([1,2,3,4,3,1,2,2,4,6,7,2,4,8,4,5]) np.sort(s) np.argsort(s) 搜索 np.where np.extract np.where(s\u0026gt;3,1,-1) np.extract(s\u0026gt;3,s) pandas 构建数组（series） series1 = pd.Series([2.8,3.01,8.99,8.59,5.18]) series2 = pd.Series([2.8,3.01,8.99,8.59,5.18],index = [\u0026#39;a\u0026#39;,\u0026#39;b\u0026#39;,\u0026#39;c\u0026#39;,\u0026#39;d\u0026#39;,\u0026#39;e\u0026#39;],name =\u0026#39;这是一个series’)  series3 = pd.Series(np.array((2.8,3.10,8.99,8.59,5.18)),index = [\u0026#39;a\u0026#39;,\u0026#39;b\u0026#39;,\u0026#39;c\u0026#39;,\u0026#39;d\u0026#39;,\u0026#39;e’]) series4 = pd.Series({\u0026#39;北京\u0026#39;:2.8,\u0026#39;上海\u0026#39;:3.01,\u0026#39;广东\u0026#39;:8.99,\u0026#39;江苏\u0026#39;:8.59,\u0026#39;浙江\u0026#39;:5.18}) 构建数组（dataframe） list1 = [[\u0026#39;张三\u0026#39;,23,\u0026#39;男\u0026#39;],[\u0026#39;李四\u0026#39;,27,\u0026#39;女\u0026#39;],[\u0026#39;王二\u0026#39;,26,\u0026#39;女\u0026#39;]]#使用嵌套列表 df1 = pd.",
    "inLanguage" : "en-us",
    "author" : "Misty",
    "creator" : "Misty",
    "publisher": "Misty",
    "accountablePerson" : "Misty",
    "copyrightHolder" : "Misty",
    "copyrightYear" : "2021",
    "datePublished": "2021-01-01 00:00:00 \u002b0000 UTC",
    "dateModified" : "2021-01-01 00:00:00 \u002b0000 UTC",
    "url" : "https:\/\/www.m1sty.com\/2021\/dm_0_clear\/",
    "wordCount" : "590",
    "keywords" : [ "Practise", "M1sty"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://www.m1sty.com">M1sty</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="About">About</a>
                
                <a class="menu-item" href="/links/" title="Links">Links</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://www.m1sty.com">M1sty</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="About">About</a>
                
                <a class="menu-item" href="/links/" title="Links">Links</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">数据清洗</h1>
        <div class="post-meta">
        <i class="far fa-folder-open"></i>
            <span class="post-category"> in
                <a href="https://www.m1sty.com/categories/data-mining/"> Data Mining </a>
                    
            </span>
          <span class="post-time"> on
        <time datetime=2021-01-01 itemprop="datePublished">January 1, 2021</time>
           </span> (<span class="post-word-count">590 words)</span>
        </div>
    
    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title"></h2>
  
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#常用工具">常用工具</a>
      <ul>
        <li><a href="#numpy">numpy</a></li>
        <li><a href="#pandas">pandas</a></li>
      </ul>
    </li>
    <li><a href="#数据清洗步骤">数据清洗步骤</a>
      <ul>
        <li><a href="#数据获取">数据获取</a></li>
        <li><a href="#数据探索">数据探索</a></li>
        <li><a href="#行列操作">行列操作</a></li>
        <li><a href="#数据整合">数据整合</a></li>
        <li><a href="#数据转换">数据转换</a></li>
        <li><a href="#分组汇总">分组汇总</a></li>
        <li><a href="#处理重复值缺失值和异常值以及数据离散化">处理重复值、缺失值和异常值以及数据离散化</a></li>
      </ul>
    </li>
    <li><a href="#知识点">知识点</a>
      <ul>
        <li><a href="#数据清洗操作顺序">数据清洗操作顺序</a></li>
        <li><a href="#脏数据">脏数据</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
<script type="text/javascript">
  window.onload = function () {
    var fix = $('.post-toc');
    var end = $('.post-comment');
    var fixTop = fix.offset().top, fixHeight = fix.height();
    var endTop, miss;
    var offsetTop = fix[0].offsetTop;
    $(window).scroll(function () {
      var docTop = Math.max(document.body.scrollTop, document.documentElement.scrollTop);
      if (end.length > 0) {
        endTop = end.offset().top;
        miss = endTop - docTop - fixHeight;
      }
      if (fixTop < docTop) {
        fix.css({ 'position': 'fixed' });
        if ((end.length > 0) && (endTop < (docTop + fixHeight))) {
          fix.css({ top: miss });
        } else {
          fix.css({ top: 0 });
        }
      } else {
        fix.css({ 'position': 'absolute' });
        fix.css({ top: offsetTop });
      }
    })
  }
</script> 
    
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          <h2 id="常用工具">常用工具</h2>
<h3 id="numpy">numpy</h3>
<h4 id="构建数组">构建数组</h4>
<ul>
<li>
<p>Numpy中常用的数据结构是ndarray格式</p>
</li>
<li>
<p>使用array函数创建，语法格式为array(列表或元组)</p>
</li>
<li>
<p>可以使用其他函数例如arange、linspace、zeros等创建</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
arr1 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">3</span>]) np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">1</span>) np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">10</span>) np<span style="color:#f92672">.</span>zeros (<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">5</span>) 
</code></pre></div><h4 id="常用方法">常用方法</h4>
<ul>
<li>
<p>常用方法名称：ndim、shape、size、dtype、运算</p>
</li>
<li>
<p>数组访问方法：array$[行，列]$</p>
</li>
</ul>
<h4 id="排序">排序</h4>
<ul>
<li>sort函数：从小到大进行排序</li>
<li>argsort函数：返回的是数据中, 从小到大的索引值</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">s <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>]) 
np<span style="color:#f92672">.</span>sort(s) 
np<span style="color:#f92672">.</span>argsort(s) 
</code></pre></div><h4 id="搜索">搜索</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">np<span style="color:#f92672">.</span>where
np<span style="color:#f92672">.</span>extract
	  
np<span style="color:#f92672">.</span>where(s<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">1</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) 
np<span style="color:#f92672">.</span>extract(s<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">3</span>,s) 
</code></pre></div><h3 id="pandas">pandas</h3>
<h4 id="构建数组series">构建数组（series）</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">series1 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>Series([<span style="color:#ae81ff">2.8</span>,<span style="color:#ae81ff">3.01</span>,<span style="color:#ae81ff">8.99</span>,<span style="color:#ae81ff">8.59</span>,<span style="color:#ae81ff">5.18</span>])
	  
series2 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>Series([<span style="color:#ae81ff">2.8</span>,<span style="color:#ae81ff">3.01</span>,<span style="color:#ae81ff">8.99</span>,<span style="color:#ae81ff">8.59</span>,<span style="color:#ae81ff">5.18</span>],index <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;a&#39;</span>,<span style="color:#e6db74">&#39;b&#39;</span>,<span style="color:#e6db74">&#39;c&#39;</span>,<span style="color:#e6db74">&#39;d&#39;</span>,<span style="color:#e6db74">&#39;e&#39;</span>],name <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;这是一个series’) </span>
	  
series3 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>Series(np<span style="color:#f92672">.</span>array((<span style="color:#ae81ff">2.8</span>,<span style="color:#ae81ff">3.10</span>,<span style="color:#ae81ff">8.99</span>,<span style="color:#ae81ff">8.59</span>,<span style="color:#ae81ff">5.18</span>)),index <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;a&#39;</span>,<span style="color:#e6db74">&#39;b&#39;</span>,<span style="color:#e6db74">&#39;c&#39;</span>,<span style="color:#e6db74">&#39;d&#39;</span>,<span style="color:#e6db74">&#39;e’])</span>
	  
series4 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>Series({<span style="color:#e6db74">&#39;北京&#39;</span>:<span style="color:#ae81ff">2.8</span>,<span style="color:#e6db74">&#39;上海&#39;</span>:<span style="color:#ae81ff">3.01</span>,<span style="color:#e6db74">&#39;广东&#39;</span>:<span style="color:#ae81ff">8.99</span>,<span style="color:#e6db74">&#39;江苏&#39;</span>:<span style="color:#ae81ff">8.59</span>,<span style="color:#e6db74">&#39;浙江&#39;</span>:<span style="color:#ae81ff">5.18</span>}) 
</code></pre></div><h4 id="构建数组dataframe">构建数组（dataframe）</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">list1 <span style="color:#f92672">=</span> [[<span style="color:#e6db74">&#39;张三&#39;</span>,<span style="color:#ae81ff">23</span>,<span style="color:#e6db74">&#39;男&#39;</span>],[<span style="color:#e6db74">&#39;李四&#39;</span>,<span style="color:#ae81ff">27</span>,<span style="color:#e6db74">&#39;女&#39;</span>],[<span style="color:#e6db74">&#39;王二&#39;</span>,<span style="color:#ae81ff">26</span>,<span style="color:#e6db74">&#39;女&#39;</span>]]<span style="color:#75715e">#使用嵌套列表</span>
df1 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(list1,columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;姓名&#39;</span>,<span style="color:#e6db74">&#39;年龄&#39;</span>,<span style="color:#e6db74">&#39;性别&#39;</span>])
	  
df2 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#39;姓名&#39;</span>:[<span style="color:#e6db74">&#39;张三&#39;</span>,<span style="color:#e6db74">&#39;李四&#39;</span>,<span style="color:#e6db74">&#39;王二&#39;</span>],<span style="color:#e6db74">&#39;年龄&#39;</span>:[<span style="color:#ae81ff">23</span>,<span style="color:#ae81ff">27</span>,<span style="color:#ae81ff">26</span>],<span style="color:#e6db74">&#39;性别&#39;</span>:[<span style="color:#e6db74">&#39;男&#39;</span>,<span style="color:#e6db74">&#39;女&#39;</span>,<span style="color:#e6db74">&#39;女&#39;</span>]}) 
	  
array1 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([[<span style="color:#e6db74">&#39;张三&#39;</span>,<span style="color:#ae81ff">23</span>,<span style="color:#e6db74">&#39;男&#39;</span>],[<span style="color:#e6db74">&#39;李四&#39;</span>,<span style="color:#ae81ff">27</span>,<span style="color:#e6db74">&#39;女&#39;</span>],[<span style="color:#e6db74">&#39;王二&#39;</span>,<span style="color:#ae81ff">26</span>,<span style="color:#e6db74">&#39;女&#39;</span>]])<span style="color:#75715e"># 使用numpy</span>
df3 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(array1,columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;姓名&#39;</span>,<span style="color:#e6db74">&#39;年龄&#39;</span>,<span style="color:#e6db74">&#39;性别&#39;</span>],index <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;a&#39;</span>,<span style="color:#e6db74">&#39;b&#39;</span>,<span style="color:#e6db74">&#39;c’] ) </span>
</code></pre></div><h4 id="常用方法-1">常用方法</h4>
<ul>
<li>常用方法名称：values、index、dtypes、shape、ndim、size、columns</li>
</ul>
<h2 id="数据清洗步骤">数据清洗步骤</h2>
<h3 id="数据获取">数据获取</h3>
<h4 id="更改文件路径">更改文件路径</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># 更改文件路径</span>
os<span style="color:#f92672">.</span>chdir(<span style="color:#e6db74">&#39;F:\CSDN\课程内容\代码和数据&#39;</span>)

<span style="color:#75715e">#设置最大显示列数</span>
pd<span style="color:#f92672">.</span>set_option(<span style="color:#e6db74">&#39;display.max_columns&#39;</span>, <span style="color:#ae81ff">20</span>)

<span style="color:#75715e">#设置最大显示行数</span>
pd<span style="color:#f92672">.</span>set_option(<span style="color:#e6db74">&#39;display.max_rows&#39;</span>, <span style="color:#ae81ff">100</span>)
</code></pre></div><h4 id="csv文件读写">csv文件读写</h4>
<ul>
<li>
<p>pandas内置了10多种数据源读取函数,常见的就是CSV和EXCEL</p>
</li>
<li>
<p>使用read_csv方法读取，结果为dataframe格式</p>
</li>
<li>
<p>在读取csv文件时，文件名称尽量是英文</p>
</li>
<li>
<p>参数较多，可以自行控制，但很多时候用默认参数</p>
</li>
<li>
<p>读取csv时，注意编码，常用编码为utf-8、gbk 、gbk2312和gb18030等</p>
</li>
<li>
<p>使用to_csv方法快速保存</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#39;meal_order_info.csv&#39;</span>,encoding <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">‘</span>gbk<span style="color:#960050;background-color:#1e0010">’</span>)
  
df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#39;meal_order_info.csv&#39;</span>,encoding <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;gbk’,nrows=10) </span>
  
df<span style="color:#f92672">.</span>to_csv(<span style="color:#960050;background-color:#1e0010">‘</span>df<span style="color:#f92672">.</span>csv<span style="color:#960050;background-color:#1e0010">’</span>,index<span style="color:#f92672">=</span>False) 
</code></pre></div><h4 id="excel文件读写">excel文件读写</h4>
<ul>
<li>
<p>使用read_excel读取,读取后的结果为dataframe格式</p>
</li>
<li>
<p>读取excel文件和csv文件参数大致一样, 但要考虑工作表sheet页</p>
</li>
<li>
<p>参数较多，可以自行控制，但很多时候用默认参数</p>
</li>
<li>
<p>读取excel时，注意编码，常用编码为utf-8、gbk 、gbk2312和gb18030等</p>
</li>
<li>
<p>使用to_excel快速保存为xlsx格式</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_excel(<span style="color:#e6db74">&#39;meal_order_info.xlsx&#39;</span>, sheet_name <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">‘</span>sheet1<span style="color:#e6db74">&#39;)</span>
  
df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span> read_excel(<span style="color:#e6db74">&#39;meal_order_info.xlsx&#39;</span>,encoding <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">‘</span>utf<span style="color:#f92672">-</span><span style="color:#ae81ff">8</span><span style="color:#960050;background-color:#1e0010">’</span>,nrows<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>) 
  
df<span style="color:#f92672">.</span>to_excel(<span style="color:#e6db74">&#39;a1.xlsx&#39;</span>, sheet_name<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">‘</span>sheet1<span style="color:#e6db74">&#39;, index= False,encoding=&#39;</span>utf<span style="color:#f92672">-</span><span style="color:#ae81ff">8</span>) 
</code></pre></div><h4 id="数据库文件读写">数据库文件读写</h4>
<ul>
<li>
<p>使用sqlalchemy建立连接</p>
</li>
<li>
<p>需要知道数据库的相关参数，如数据库IP地址、用户名和密码等</p>
</li>
<li>
<p>通过pandas中read_sql函数读入, 读取完以后是dataframe格式</p>
</li>
<li>
<p>通过dataframe的to_sql方法保存</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">sql <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;select * from meal_order_info&#39;</span> <span style="color:#75715e">#选择数据库中表名称 </span>
  
df1 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(sql,conn) 
  
df<span style="color:#f92672">.</span>to_sql(<span style="color:#e6db74">&#39;testdf&#39;</span>,con <span style="color:#f92672">=</span> conn, index<span style="color:#f92672">=</span> False,if_exists<span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;replace&#39;</span>) 
</code></pre></div><h4 id="数据库建立连接参数">数据库建立连接参数</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">conn <span style="color:#f92672">=</span> create_engine(<span style="color:#e6db74">&#39;mysql+pymysql://user:passward@IP:3306/test01&#39;</span>) 
</code></pre></div><ul>
<li>root: 用户名</li>
<li>passward: 密码</li>
<li>IP : 服务器IP，本地电脑用localhost</li>
<li>3306: 端口号</li>
<li>test01 : 数据库名称</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df<span style="color:#f92672">.</span>to_sql(name, con<span style="color:#f92672">=</span>engine, if_exists<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;replace/append/fail&#39;</span>,index<span style="color:#f92672">=</span>False) 
</code></pre></div><ul>
<li>name是表名</li>
<li>con是连接</li>
<li>if_exists:表如果存在怎么处理。三个选项 append代表追加, replace代表删除原表，建立新表，fail代表什么都不干</li>
<li>index=False:不插入索引index</li>
</ul>
<h3 id="数据探索">数据探索</h3>
<ul>
<li>shape</li>
<li>describe</li>
<li>info</li>
<li>head</li>
<li>dtypes</li>
</ul>
<h3 id="行列操作">行列操作</h3>
<h4 id="数据常用筛选方法lociloc">数据常用筛选方法(loc/iloc)</h4>
<ul>
<li>loc$[行索引名称或者条件,列索引名称或者标签]$</li>
<li>iloc$[行索引位置,列索引位置]$</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">basic[[<span style="color:#e6db74">&#39;户主姓名&#39;</span>,<span style="color:#e6db74">&#39;农户生产经营类型&#39;</span>]] 
  
basic<span style="color:#f92672">.</span>loc[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">2</span>,[<span style="color:#e6db74">&#39;户主姓名&#39;</span>, <span style="color:#e6db74">&#39;户主身份证号&#39;</span>]] 
  
order<span style="color:#f92672">.</span>iloc[:,[<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>]] 
  
basic<span style="color:#f92672">.</span>loc[basic[<span style="color:#e6db74">&#39;健康状况&#39;</span>]<span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;良好&#39;</span>,[<span style="color:#e6db74">&#39;户主姓名&#39;</span>, <span style="color:#e6db74">&#39;户主身份证号&#39;</span>,<span style="color:#e6db74">&#39;健康状况&#39;</span>]] 
  
basic<span style="color:#f92672">.</span>iloc[<span style="color:#ae81ff">3</span>,[<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>]] 
</code></pre></div><h4 id="数据增加和删除insertdeldrop">数据增加和删除(insert/del/drop)</h4>
<ul>
<li>在数据中,直接添加列</li>
<li>使用df.insert方法在数据中添加一列</li>
<li>掌握drop(labels,axis,inplace=True) 的用法</li>
<li>labels表示删除的数据, axis表示作用轴，inplace=True表示是否对原数据生效</li>
<li>axis=0按行操作, axis=1按列操作</li>
<li>使用del函数直接删除其中一列</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">del</span> basic[<span style="color:#e6db74">&#39;数据&#39;</span>]
  
basic<span style="color:#f92672">.</span>drop(labels <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;敬老爱幼情况&#39;</span>, <span style="color:#e6db74">&#39;家庭和睦情况&#39;</span>],axis <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,inplace<span style="color:#f92672">=</span>True) 
  
basic<span style="color:#f92672">.</span>drop(labels<span style="color:#f92672">=</span> range(<span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">11</span>),axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>,inplace<span style="color:#f92672">=</span>True) 
  
basic<span style="color:#f92672">.</span>insert(<span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;出生年月&#39;</span>, mid) 
</code></pre></div><h4 id="数据修改和查找">数据修改和查找</h4>
<ul>
<li>在数据中, 可以使用rename修改列名称或者行索引名称</li>
<li>使用loc方法修改数据</li>
<li>使用loc方法查找符合条件的数据</li>
<li>条件与条件之间用&amp;或者|连接，分别代表‘且’和‘或’</li>
<li>使用between和isin选择满足条件的行</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">basic[[<span style="color:#e6db74">&#39;户主身份证号&#39;</span>,<span style="color:#e6db74">&#39;性别&#39;</span>]][(basic<span style="color:#f92672">.</span><span style="color:#960050;background-color:#1e0010">健康状况</span><span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;良好&#39;</span>) <span style="color:#f92672">&amp;</span> (basic[<span style="color:#e6db74">&#39;农户家庭人数&#39;</span>] <span style="color:#f92672">&gt;</span><span style="color:#ae81ff">3</span>)] 
  
basic[[<span style="color:#e6db74">&#39;户主身份证号&#39;</span>,<span style="color:#e6db74">&#39;性别&#39;</span>,<span style="color:#e6db74">&#39;婚姻状况&#39;</span>]][ basic[<span style="color:#e6db74">&#39;农户家庭人数&#39;</span>]<span style="color:#f92672">.</span>between(<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">10</span>,inclusive<span style="color:#f92672">=</span>True)] 
  
basic<span style="color:#f92672">.</span>loc[basic[<span style="color:#e6db74">&#39;是否加入农民合作社&#39;</span>]<span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;未知&#39;</span>, <span style="color:#e6db74">&#39;是否加入农民合作社&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;否‘ </span>
  
basic<span style="color:#f92672">.</span>rename(columns <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;出生年月&#39;</span>:<span style="color:#e6db74">&#39;出生日期&#39;</span>,<span style="color:#e6db74">&#39;文化程度&#39;</span>:<span style="color:#e6db74">&#39;受教育水平&#39;</span> },inplace <span style="color:#f92672">=</span> True) 
  
basic<span style="color:#f92672">.</span>rename(index <span style="color:#f92672">=</span> {<span style="color:#ae81ff">1</span>:<span style="color:#e6db74">&#39;one&#39;</span>,<span style="color:#e6db74">&#39;10&#39;</span>:<span style="color:#e6db74">&#39;ten&#39;</span> },inplace <span style="color:#f92672">=</span> True) 
</code></pre></div><h3 id="数据整合">数据整合</h3>
<h4 id="数据整理concatappend">数据整理(concat/append)</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">merge1 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([df1,df2],axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,join<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;inner’)</span>
  
merge1 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([df1,df2],axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,join<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;outer’)</span>
  
order_merge <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([order1,order2,order3],axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, ignore_index<span style="color:#f92672">=</span>False) 
  
order_merge<span style="color:#f92672">.</span>reset_index(inplace<span style="color:#f92672">=</span>True) 
  
append
</code></pre></div><h4 id="层次化索引">层次化索引</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df<span style="color:#f92672">.</span>loc[(<span style="color:#ae81ff">28</span>,[<span style="color:#ae81ff">82830661</span>,<span style="color:#ae81ff">532110457</span>]),[<span style="color:#e6db74">&#39;auction_id&#39;</span>,<span style="color:#e6db74">&#39;cat_id&#39;</span>]]
<span style="color:#75715e"># 第二层索引选择，选择2个变量</span>
</code></pre></div><ul>
<li>直接引用两层</li>
<li>df3.loc$[(a,b),:]$ # a和b分别代表第一层和第二层的索引</li>
<li>接受tuple</li>
</ul>
<h3 id="数据转换">数据转换</h3>
<h4 id="日期格式数据处理datatimedttimedelta">日期格式数据处理(datatime/dt/Timedelta)</h4>
<ul>
<li>Pandas中使用to_datetime()方法将文本格式转换为日期格式</li>
<li>dataframe数据类型如果为datetime64,可以使用dt方法取出年月日等</li>
<li>对于时间差数据,可以使用timedelta函数将其转换为指定时间单位的数值</li>
<li>时间差数据,可以使用dt方法访问其常用属性</li>
</ul>
<h4 id="字符串数据处理">字符串数据处理</h4>
<ul>
<li>Pandas中提供了字符串的函数,但只能对字符型变量进行使用</li>
<li>通过str方法访问相关属性</li>
<li>可以使用字符串的相关方法进行数据处理
<ul>
<li>contains()</li>
<li>replace()</li>
<li>lower()</li>
<li>upper()</li>
<li>split()</li>
<li>strip()</li>
<li>join()</li>
</ul>
</li>
</ul>
<h4 id="高阶函数数据处理">高阶函数数据处理</h4>
<ul>
<li>在dataframe中使用apply方法，调用自定义函数对数据进行处理</li>
<li>函数apply, axis=0表示对行进行操作,axis=1表示对列进行操作</li>
<li>可以使用astype函数对数据进行转换</li>
<li>可以使用map函数进行数据转换</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># 0代表女，1代表男，2代表未知</span>
df2[<span style="color:#e6db74">&#39;性别&#39;</span>] <span style="color:#f92672">=</span> df2[<span style="color:#e6db74">&#39;gender&#39;</span>]<span style="color:#f92672">.</span>apply(f)
  
<span style="color:#75715e">#使用map函数</span>
df2[<span style="color:#e6db74">&#39;性别&#39;</span>] <span style="color:#f92672">=</span> df2[<span style="color:#e6db74">&#39;gender&#39;</span>]<span style="color:#f92672">.</span>map({<span style="color:#e6db74">&#39;0&#39;</span>:<span style="color:#e6db74">&#39;女&#39;</span>,<span style="color:#e6db74">&#39;1&#39;</span>:<span style="color:#e6db74">&#39;男&#39;</span>,<span style="color:#e6db74">&#39;2&#39;</span>:<span style="color:#e6db74">&#39;未知&#39;</span>})

<span style="color:#75715e">#lambda</span>
df2[<span style="color:#e6db74">&#39;user_id&#39;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: x<span style="color:#f92672">.</span>replace(x[<span style="color:#ae81ff">1</span>:<span style="color:#ae81ff">3</span>],<span style="color:#e6db74">&#39;**&#39;</span>)) 
</code></pre></div><h3 id="分组汇总">分组汇总</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">var_name <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;Food%&#39;</span>, <span style="color:#e6db74">&#39;Fresh%&#39;</span>, <span style="color:#e6db74">&#39;Drinks%&#39;</span>]

df[var_name]<span style="color:#f92672">.</span>apply(np<span style="color:#f92672">.</span>sum,axis <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) <span style="color:#75715e">#相当于计算每列的总和</span>

df[<span style="color:#e6db74">&#39;sum&#39;</span>] <span style="color:#f92672">=</span> df[var_name]<span style="color:#f92672">.</span>apply(np<span style="color:#f92672">.</span>sum,axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)

var_name<span style="color:#f92672">.</span>append(<span style="color:#e6db74">&#39;sum&#39;</span>)

df[var_name]

df[var_name]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: x[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> x[<span style="color:#ae81ff">1</span>],axis <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) 
<span style="color:#75715e">#计算食物在订单总价中占比 - 生鲜类食物在订单总中占比</span>
</code></pre></div><h4 id="数据分组运算dfgroupbyby-">数据分组运算$(df.groupby(by=[' &lsquo;]))$</h4>
<ul>
<li>使用groupby方法进行分组计算，得到分组对象GroupBy</li>
<li>语法为df.groupby(by=)</li>
<li>分组对象GroupBy可以运用描述性统计方法, 如count、mean、 median、max和min等</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">Group <span style="color:#f92672">=</span> loan_info<span style="color:#f92672">.</span>groupby(by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;product’) </span>
Group1<span style="color:#f92672">=</span> loan_info<span style="color:#f92672">.</span>groupby(by <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;product&#39;</span>,<span style="color:#e6db74">&#39;jgmc’]) Group.mean()</span>
Group<span style="color:#f92672">.</span>sum()
Group<span style="color:#f92672">.</span>max() 
</code></pre></div><h4 id="聚合函数使用groupbyaggfunc">聚合函数使用(Groupby.agg(func))</h4>
<ul>
<li>对分组对象使用agg聚合函数</li>
<li>针对不同的变量使用不同的统计方法</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">grouped<span style="color:#f92672">.</span>agg({<span style="color:#e6db74">&#39;total_items&#39;</span>:[np<span style="color:#f92672">.</span>sum],<span style="color:#e6db74">&#39;Food%&#39;</span>:[np<span style="color:#f92672">.</span>mean,np<span style="color:#f92672">.</span>median]})
</code></pre></div><h4 id="分组对象和apply函数groupbyapplyfunc">分组对象和apply函数(Groupby.apply(func))</h4>
<ul>
<li>函数apply即可用于分组对象,也可以作用于dataframe数据</li>
<li>需要注意axis=0和axis=1的区别</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df[var_name]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: x[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span>x[<span style="color:#ae81ff">1</span>],axis <span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
  
df[<span style="color:#e6db74">&#39;sum&#39;</span>] <span style="color:#f92672">=</span> df[var_name]<span style="color:#f92672">.</span>apply(np<span style="color:#f92672">.</span>sum,axis <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
</code></pre></div><h4 id="透视图与交叉表">透视图与交叉表</h4>
<ul>
<li>透视表</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">pivot_table( data, index, columns,values, aggfunc, fill_value, margins, margins_name<span style="color:#f92672">=</span>)
</code></pre></div><ul>
<li>
<p>Index : 行分组键</p>
</li>
<li>
<p>columns: 列分组键</p>
</li>
<li>
<p>values: 分组的字段，只能为数值型变量</p>
</li>
<li>
<p>aggfunc: 聚合函数</p>
</li>
<li>
<p>margins: 是否需要总计</p>
</li>
<li>
<p>交叉表用于计算分组频率</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">pd<span style="color:#f92672">.</span>crosstab(index,columns,normalize)
</code></pre></div><ul>
<li>Index: 行索引</li>
<li>Columns: 列索引</li>
<li>Normalize: 数据对数据进行标准化，index表示行，column表示列</li>
</ul>
<h3 id="处理重复值缺失值和异常值以及数据离散化">处理重复值、缺失值和异常值以及数据离散化</h3>
<h4 id="重复值处理">重复值处理</h4>
<ul>
<li>查找</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df[df<span style="color:#f92672">.</span>duplicated()]
np<span style="color:#f92672">.</span>sum(df<span style="color:#f92672">.</span>duplicated())
</code></pre></div><ul>
<li>删除</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df<span style="color:#f92672">.</span>drop_duplicates()
df<span style="color:#f92672">.</span>drop_duplicates(subset<span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;appname&#39;</span>,<span style="color:#e6db74">&#39;size&#39;</span>],inplace<span style="color:#f92672">=</span>True) 
</code></pre></div><h4 id="缺失值处理">缺失值处理</h4>
<ul>
<li>查找</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: sum(x<span style="color:#f92672">.</span>isnull())<span style="color:#f92672">/</span>len(x),axis<span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) <span style="color:#75715e">#缺失比例</span>
  
df[df[<span style="color:#e6db74">&#39;Exterior_Color&#39;</span>]<span style="color:#f92672">.</span>isnull()]
</code></pre></div><ul>
<li>删除</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df<span style="color:#f92672">.</span>dropna() <span style="color:#75715e">#直接删除法</span>
	  
df<span style="color:#f92672">.</span>dropna(how<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;any&#39;</span>,axis <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> ) <span style="color:#75715e">#只要有缺失，就删除这一列</span>
	  
df<span style="color:#f92672">.</span>dropna(axis <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,how<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;any&#39;</span>,subset<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Condition&#39;</span>,<span style="color:#e6db74">&#39;Price&#39;</span>,<span style="color:#e6db74">&#39;Mileage&#39;</span>]) 
<span style="color:#75715e"># 1代表列，0代表行，只要有缺失，就删除这一行,基于三个变量</span>
</code></pre></div><ul>
<li>填补</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df<span style="color:#f92672">.</span>Mileage<span style="color:#f92672">.</span>fillna(df<span style="color:#f92672">.</span>Mileage<span style="color:#f92672">.</span>mean()) <span style="color:#75715e"># 年龄用均值填补</span>
	  
df<span style="color:#f92672">.</span>Mileage<span style="color:#f92672">.</span>fillna(df<span style="color:#f92672">.</span>Mileage<span style="color:#f92672">.</span>median()) <span style="color:#75715e"># 中位数填补</span>
	  
df<span style="color:#f92672">.</span>fillna(<span style="color:#ae81ff">20</span>) <span style="color:#75715e"># 所有缺失用20填补</span>
	  
df<span style="color:#f92672">.</span>Exterior_Color<span style="color:#f92672">.</span>fillna(df<span style="color:#f92672">.</span>Exterior_Color<span style="color:#f92672">.</span>mode()[<span style="color:#ae81ff">0</span>])  <span style="color:#75715e"># 众数填补 </span>

<span style="color:#75715e"># 婚姻状况使用众数,年龄使用均值,农户家庭人数使用中位数</span>
df<span style="color:#f92672">.</span>fillna(value <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;Exterior_Color&#39;</span>:df<span style="color:#f92672">.</span>Exterior_Color<span style="color:#f92672">.</span>mode()[<span style="color:#ae81ff">0</span>],<span style="color:#e6db74">&#39;Mileage&#39;</span>:df<span style="color:#f92672">.</span>Mileage<span style="color:#f92672">.</span>mean()})
	
<span style="color:#75715e"># 前向填补</span>
df[<span style="color:#e6db74">&#39;Exterior_Color&#39;</span>]<span style="color:#f92672">.</span>fillna(method<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ffill&#39;</span>)
  
<span style="color:#75715e"># 后向填补bfill</span>
</code></pre></div><h4 id="异常值处理">异常值处理</h4>
<p>指那些偏离正常范围的值，不是错误值</p>
<p>异常值出现频率较低，但又会对实际项目分析造成偏差</p>
<p>异常值一般用过箱线图法(分位差法)或者分布图(标准差法)来判断</p>
<p>异常值往往采取盖帽法或者数据离散化</p>
<ul>
<li>检查</li>
</ul>
<p><strong>异常值检测之标准差法</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">xbar <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>Price<span style="color:#f92672">.</span>mean() 
xstd <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>Price<span style="color:#f92672">.</span>std()
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;标准差法异常值上限检测：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>,any(df<span style="color:#f92672">.</span>Price<span style="color:#f92672">&gt;</span> xbar <span style="color:#f92672">+</span> <span style="color:#ae81ff">2.5</span> <span style="color:#f92672">*</span> xstd))
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;标准差法异常值下限检测：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>,any(df<span style="color:#f92672">.</span>Price<span style="color:#f92672">&lt;</span> xbar <span style="color:#f92672">-</span> <span style="color:#ae81ff">2.5</span> <span style="color:#f92672">*</span> xstd))
</code></pre></div><p><strong>异常值检测之箱线图法</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">Q1 <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>Price<span style="color:#f92672">.</span>quantile(q <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.25</span>)
Q3 <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>Price<span style="color:#f92672">.</span>quantile(q <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.75</span>)
IQR <span style="color:#f92672">=</span> Q3 <span style="color:#f92672">-</span> Q1
		  
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;箱线图法异常值上限检测：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>,any(df<span style="color:#f92672">.</span>Price <span style="color:#f92672">&gt;</span> Q3 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1.5</span> <span style="color:#f92672">*</span> IQR))
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;箱线图法异常值下限检测：</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>,any(df<span style="color:#f92672">.</span>Price <span style="color:#f92672">&lt;</span> Q1 <span style="color:#f92672">-</span> <span style="color:#ae81ff">1.5</span> <span style="color:#f92672">*</span> IQR))
</code></pre></div><p><strong>绘图</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#箱图</span>
df<span style="color:#f92672">.</span>Price<span style="color:#f92672">.</span>plot(kind <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;box&#39;</span>)
		  
<span style="color:#75715e"># 设置绘图风格</span>
plt<span style="color:#f92672">.</span>style<span style="color:#f92672">.</span>use(<span style="color:#e6db74">&#39;seaborn&#39;</span>)
<span style="color:#75715e"># 绘制直方图</span>
df<span style="color:#f92672">.</span>Price<span style="color:#f92672">.</span>plot(kind <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;hist&#39;</span>, bins <span style="color:#f92672">=</span> <span style="color:#ae81ff">30</span>, density <span style="color:#f92672">=</span> True)
<span style="color:#75715e"># 绘制核密度图</span>
df<span style="color:#f92672">.</span>Price<span style="color:#f92672">.</span>plot(kind <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;kde&#39;</span>)
<span style="color:#75715e"># 图形展现</span>
plt<span style="color:#f92672">.</span>show()
</code></pre></div><ul>
<li>处理</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#用99分位数和1分位数替换</span>
<span style="color:#75715e">#计算P1和P99</span>
P1 <span style="color:#f92672">=</span>df<span style="color:#f92672">.</span>Price<span style="color:#f92672">.</span>quantile(<span style="color:#ae81ff">0.01</span>); 
P99 <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>Price<span style="color:#f92672">.</span>quantile(<span style="color:#ae81ff">0.99</span>)
	  
<span style="color:#75715e">#先创建一个新变量，进行赋值，然后将满足条件的数据进行替换</span>
df[<span style="color:#e6db74">&#39;Price_new&#39;</span>] <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#39;Price&#39;</span>]
df<span style="color:#f92672">.</span>loc[df[<span style="color:#e6db74">&#39;Price&#39;</span>] <span style="color:#f92672">&gt;</span> P99,<span style="color:#e6db74">&#39;Price_new&#39;</span>]  <span style="color:#f92672">=</span> P99
df<span style="color:#f92672">.</span>loc[df[<span style="color:#e6db74">&#39;Price&#39;</span>] <span style="color:#f92672">&lt;</span> P1,<span style="color:#e6db74">&#39;Price_new&#39;</span>]  <span style="color:#f92672">=</span> P1
	  
df[[<span style="color:#e6db74">&#39;Price&#39;</span>,<span style="color:#e6db74">&#39;Price_new&#39;</span>]]<span style="color:#f92672">.</span>describe()
</code></pre></div><h4 id="数据离散化">数据离散化</h4>
<p>数据离散化就是分箱</p>
<p>一般常用分箱方法是等频分箱或者等宽分箱</p>
<p>一般使用pd.cut或者pd.qcut函数</p>
<ul>
<li>cut</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">pandas<span style="color:#f92672">.</span>cut(x, bins, right<span style="color:#f92672">=</span>True, labels<span style="color:#f92672">=</span>None, retbins<span style="color:#f92672">=</span>False, precision<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, include_lowest<span style="color:#f92672">=</span>False)
</code></pre></div><ul>
<li>qcut</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">pandas<span style="color:#f92672">.</span>qcut(x, q, labels<span style="color:#f92672">=</span>None, retbins<span style="color:#f92672">=</span>False, precision<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, duplicates<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">’</span><span style="color:#66d9ef">raise</span><span style="color:#960050;background-color:#1e0010">’</span>)
</code></pre></div><h2 id="知识点">知识点</h2>
<h3 id="数据清洗操作顺序">数据清洗操作顺序</h3>
<ol>
<li>选择子集</li>
<li>重命名列</li>
<li>缺失数据处理</li>
<li>数据类型的转换</li>
<li>字符串的处理</li>
<li>时间日期的处理</li>
<li>数据排序</li>
<li>异常值处理</li>
</ol>
<h3 id="脏数据">脏数据</h3>
<ul>
<li>数据缺失</li>
<li>数据噪声</li>
<li>数据不一致</li>
<li>数据冗余</li>
<li>离群点/异常值</li>
<li>数据重复是在数据集中出现多次的数据</li>
</ul>

    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>M1sty </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://www.m1sty.com/2021/dm_0_clear/>https://www.m1sty.com/2021/dm_0_clear/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="https://www.m1sty.com/tags/practise/">
                    #Practise</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://www.m1sty.com">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://www.m1sty.com/2020/database_sql_50/" class="prev" rel="prev" title="SQL面试必会50题_题解"><i class="iconfont icon-left"></i>&nbsp;SQL面试必会50题_题解</a>
         
        
        <a href="https://www.m1sty.com/2021/project_data-index_content/" class="next" rel="next" title="数据指标体系搭建（以PY项目为例）【施工中……】">数据指标体系搭建（以PY项目为例）【施工中……】&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2020 - 2021</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://www.m1sty.com">M1sty</a> | </span> 
         

         
		  <span> <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Data Analyst</a> => <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">Data Scientist</a></span> 
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  




<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            displayMath: [['$$','$$'], ['\[','\]']],
            processEscapes: true,
            processEnvironments: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            TeX: {
                equationNumbers: { autoNumber: "AMS" },
                extensions: ["AMSmath.js", "AMSsymbols.js"]
            }
        }
    });
</script>
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
     </div>
  </body>
</html>
